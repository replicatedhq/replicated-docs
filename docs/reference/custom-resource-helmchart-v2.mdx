import VersionLimitation from "../partials/helm/_helm-version-limitation.mdx"
import HelmBuilderRequirements from "../partials/helm/_helm-builder-requirements.mdx"
import Chart from "../partials/helm/_helm-cr-chart.mdx"
import ChartName from "../partials/helm/_helm-cr-chart-name.mdx"
import ChartVersion from "../partials/helm/_helm-cr-chart-version.mdx"
import ChartReleaseName from "../partials/helm/_helm-cr-chart-release-name.mdx"
import HelmUpgradeFlags from "../partials/helm/_helm-cr-upgrade-flags.mdx"
import Values from "../partials/helm/_helm-cr-values.mdx"
import Weight from "../partials/helm/_helm-cr-weight.mdx"
import Exclude from "../partials/helm/_helm-cr-exclude.mdx"
import OptionalValues from "../partials/helm/_helm-cr-optional-values.mdx"
import OptionalValuesWhen from "../partials/helm/_helm-cr-optional-values-when.mdx"
import OptionalValuesRecursiveMerge from "../partials/helm/_helm-cr-optional-values-recursive-merge.mdx"
import Namespace from "../partials/helm/_helm-cr-namespace.mdx"
import BuilderAirgapIntro from "../partials/helm/_helm-cr-builder-airgap-intro.mdx"
import BuilderExample from "../partials/helm/_helm-cr-builder-example.mdx"
import V2Example from "../partials/helm/_v2-native-helm-cr-example.mdx"
import KotsHelmCrDescription from "../partials/helm/_kots-helm-cr-description.mdx"

# HelmChart v2

This topic describes the KOTS HelmChart v2 custom resource.

<KotsHelmCrDescription/>

## Example

The following is an example manifest file for the HelmChart v2 custom resource:

<V2Example/>

## chart

<Chart/>

### chart.name

<ChartName/>

### chart.chartVersion

<ChartVersion/>

## releaseName

<ChartReleaseName/>

## weight

<Weight/>

## helmUpgradeFlags

<HelmUpgradeFlags/>

## exclude

<Exclude/>

## values

<Values/>

For more information about using `values`, see [Setting Helm Chart Values with KOTS](/vendor/helm-optional-value-keys).

## optionalValues {#optionalvalues}

<OptionalValues/>

For more information about using `optionalValues`, see [Setting Helm Chart Values with KOTS](/vendor/helm-optional-value-keys).

### optionalValues.when

<OptionalValuesWhen/>

### optionalValues.recursiveMerge

<OptionalValuesRecursiveMerge/>

**Default**: False

For an example of recursive and non-recursive merging, see [About Recursive Merge](/vendor/helm-optional-value-keys#recursive-merge).

### optionalValues.values

In the `optionalValues.values` key, you list the values to set if the specified condition is met.

For example:

```yaml
  optionalValues:
    - when: "repl{{ ConfigOptionEquals `mariadb_type` `external`}}"
      recursiveMerge: false
      values:
        externalDatabase:
          host: "repl{{ ConfigOption `external_db_host`}}"
          user: "repl{{ ConfigOption `external_db_user`}}"
          password: "repl{{ ConfigOption `external_db_password`}}"
          database: "repl{{ ConfigOption `external_db_database`}}"
          port: "repl{{ ConfigOption `external_ db_port`}}"
```

In this example, the Replicated installer renders the template functions and sets the `externalDatabase` values only when the user selects the `external` option for the `mariadb_type` config option.

## namespace

<Namespace/>

## builder

#### Overview

The `builder` key contains the minimum Helm values required so that the output of `helm template` exposes all container images needed to install the chart in an air-gapped environment.

The Replicated Vendor Portal uses the Helm values that you provide in the `builder` key to run `helm template` on the chart, then parses the output to generate a list of required images for the chart. 

The Vendor Portal then uses this list of images to do the following:
* Create the Helm CLI air gap installation instructions that are automatically made available to customers in the Replicated Enterprise Portal or Download Portal. For more information, see [Install and Update with Helm in Air Gap Environments](/vendor/helm-install-airgap). 
* Build the `.airgap` bundle for a release to support air gap installations with a Replicated installer (Embedded Cluster, KOTS, kURL). For more information about how to build `.airgap` bundles, see [Package Air Gap Bundles for Helm Charts](/vendor/helm-packaging-airgap-bundles).
* Determine which images to scan and report on in the Security Center (Alpha). For more information about the Security Center, see [About the Security Center (Alpha)](/vendor/security-center-about).

The `builder` key is required to support the following installation types:

* Air gap installations with a Replicated installer (Embedded Cluster, KOTS, kURL)
* Air gap installations with the Helm CLI
* Online installations with a Replicated installer where the user will push images to a local image registry

#### Requirements

<HelmBuilderRequirements/>

#### Example

<BuilderExample/>