import ConfigValuesExample from "../partials/configValues/_configValuesExample.mdx"
import ConfigValuesProcedure from "../partials/configValues/_config-values-procedure.mdx"
import ConfigValuesRequirements from "../partials/configValues/_requirements.mdx"

# Automate Installation with Embedded Cluster

This topic describes how to install an application with Replicated Embedded Cluster from the command line, without needing to access the Replicated KOTS Admin Console.

## Overview

A common use case for installing with Embedded Cluster from the command line is to automate installation, such as performing headless installations as part of CI/CD pipelines.

With headless installation, you provide all the necessary installation assets, such as the license file and the application config values, with the installation command rather than through the Admin Console UI. Any preflight checks defined for the application run automatically during headless installations from the command line rather than being displayed in the Admin Console.

## Prerequisite

Create a ConfigValues resource to define the configuration values for the application. The ConfigValues resource allows you to pass the configuration values for an application from the command line with the install command, rather than through the Admin Console UI. For air-gapped environments, ensure that the ConfigValues file can be accessed from the installation environment. 

The ConfigValues resource includes the fields that are defined in the Replicated KOTS Config custom resource for the release, along with the user-supplied and default values for each field, as shown in the example below:

<ConfigValuesExample/>

#### ConfigValues Requirements

<ConfigValuesRequirements/>

For more information, see [ConfigValues](/reference/custom-resource-configvalues).

## Limitation

Automating deployment with Embedded Cluster is supported only for the initial installation. Performing automated (headless) updates of existing installations with Embedded Cluster is not supported. For information about how to update an existing installation through the Admin Console UI, see [Perform Updates in Embedded Clusters](/enterprise/updating-embedded).

## Online (Internet-Connected) Installation

To install with Embedded Cluster in an online environment:

1. Follow the steps provided in the Vendor Portal to download and untar the Embedded Cluster installation assets. For more information, see [Online Installation with Embedded Cluster](/enterprise/installing-embedded).

1. Run the following command to install:

    ```bash
    sudo ./APP_SLUG install --license PATH_TO_LICENSE \
      --config-values PATH_TO_CONFIGVALUES \
      --admin-console-password ADMIN_CONSOLE_PASSWORD \
      [--ignore-app-preflights] \
      [--tls-cert CUSTOM_TLS_CERT] \
      [--tls-key CUSTOM_TLS_KEY]
    ```

    Where:
    * `APP_SLUG` is the unique slug for the application.
    * `PATH_TO_LICENSE` is the path to the customer license.
    * `ADMIN_CONSOLE_PASSWORD` is a password for accessing the Admin Console.
    * `PATH_TO_CONFIGVALUES` is the path to the ConfigValues file.
    * (Optional) `--ignore-app-preflights` is an optional flag that can be passed to ignore any warnings and failures in application-specific preflight checks.
    * (Optional) `CUSTOM_TLS_CERT` is the path to a custom TLS certificate for securing the Admin Console.
    * (Optional) `CUSTOM_TLS_KEY` is the TLS key for the custom certificate. 

    For more information about the `install` command options, see [install](/reference/embedded-cluster-install).

## Air Gap Installation

To install with Embedded Cluster in an air-gapped environment:

1. Follow the steps provided in the Vendor Portal to download and untar the Embedded Cluster air gap installation assets. For more information, see [Air Gap Installation with Embedded Cluster](/enterprise/installing-embedded-air-gap).

1. Ensure that the Embedded Cluster installation assets are available on the air-gapped machine, then run the following command to install:

    ```bash
    sudo ./APP_SLUG install --license PATH_TO_LICENSE \
      --config-values PATH_TO_CONFIGVALUES \
      --admin-console-password ADMIN_CONSOLE_PASSWORD \
      --airgap-bundle PATH_TO_AIRGAP_BUNDLE \
      [--ignore-app-preflights] \
      [--tls-cert CUSTOM_TLS_CERT] \
      [--tls-key CUSTOM_TLS_KEY]
    ```

    Replace:
    * `APP_SLUG` with the unique slug for the application.
    * `PATH_TO_LICENSE` with the path to the customer license.
    * `PATH_TO_CONFIGVALUES` with the path to the ConfigValues file.
    * `ADMIN_CONSOLE_PASSWORD` with a password for accessing the Admin Console.
    * `PATH_TO_AIRGAP_BUNDLE` with the path to the Embedded Cluster `.airgap` bundle for the release.
    * (Optional) `--ignore-app-preflights` is an optional flag that can be passed to ignore any warnings and failures in application-specific preflight checks.
    * (Optional) `CUSTOM_TLS_CERT` is the path to a custom TLS certificate for securing the Admin Console.
    * (Optional) `CUSTOM_TLS_KEY` is the TLS key for the custom certificate.

    For more information about the `install` command options, see [install](/reference/embedded-cluster-install).
