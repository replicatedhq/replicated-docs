import DependencyYaml from "../partials/replicated-sdk/_dependency-yaml.mdx"
import HelmPackage from "../partials/helm/_helm-package.mdx"
import Tabs from '@theme/Tabs';
import TabItem from '@theme/TabItem';
import HelmChartCr from "../partials/getting-started/_slackernews-chart.mdx"
import KotsCr from "../partials/getting-started/_slackernews-repl-app.mdx"
import K8sCr from "../partials/getting-started/_slackernews-k8s-app.mdx"
import EcCr from "../partials/getting-started/_slackernews-embedded-cluster.mdx"
import ConfigCr from "../partials/getting-started/_slackernews-config.mdx"
import Requirements from "../partials/embedded-cluster/_requirements.mdx"

# Replicated Quick Start

This topic provides a quick start workflow to help new users learn about the Replicated Platform. Complete this quick start before you onboard your application to the platform.

## Introduction

This quick start shows how to create, install, and update releases for a sample Helm chart in the Replicated Platform. You will repeat these same basic steps to create and test releases throughout the onboarding process to integrate Replicated features with your own application.

The goals of this quick start are to introduce new Replicated users to the following common tasks for the purpose of preparing to onboard to the Replicated Platform:

* Working with _applications_, _channels_, _releases_, and _customers_ in the Replicated Vendor Portal

* Working with the Replicated CLI

* Creating test environments with Compatibility Matrix

* Installing and updating applications on a VM with Replicated Embedded Cluster

## Prerequisite

* This quick start assumes that you have a GitHub account with an SSH key set up.

## Quick Start

1. Create an account in the Vendor Portal. You can either create a new team or join an existing team. For more information, see [Create a Vendor Account](vendor-portal-creating-account).

1. In your **Account Settings**, add your GitHub username. Compatibility Matrix will reference this username in a later step.

1. Create an application using the Replicated CLI:

   1. On your local machine, install the Replicated CLI:

      ```bash
      brew install replicatedhq/replicated/cli
      ```
      For more installation options, see [Install the Replicated CLI](/reference/replicated-cli-installing).

   1. Authorize the Replicated CLI:

      ```bash
      replicated login
      ```
      In the browser window that opens, complete the prompts to log in to your Vendor Portal account and authorize the CLI.

   1. Create an application named `SlackerNews`:

      ```bash
      replicated app create SlackerNews
      ```

   1. Set the `REPLICATED_APP` environment variable to the application that you created:

      ```bash
      export REPLICATED_APP=APP_SLUG
      ```
      Where `APP_SLUG` is the unique application slug provided in the output of the `app create` command. For example, `export REPLICATED_APP=slackernews-kite`.

      This allows you to interact with the application using the Replicated CLI without needing to use the `--app` flag with every command.

1. Get the sample SlackerNews Helm chart:

   1. Run the following commands to download version 0.4.14 of the `slackernews` Helm chart: 

      ```
      curl -O --create-dirs --output-dir quick-start https://docs.replicated.com/slackernews-0.4.14.tar.gz
      ```
   
   1. Run the following command to untar the chart:

      ```
      tar -xzf quick-start/slackernews-0.4.14.tar.gz -C quick-start/
      ```
      For more information about this chart, see the [slackernews](https://github.com/slackernews/slackernews) repository in GitHub.

   1. Change to the new `chart/slackernews` directory that was created:
      
      ```bash
      cd chart/slackernews
      ```

   1. In the Helm chart `Chart.yaml`, add the Replicated SDK as a dependency:

      <DependencyYaml/>

      The Replicated SDK is a Helm chart that provides access to Replicated features and can be installed as a small service alongside your application. For more information, see [About the Replicated SDK](/vendor/replicated-sdk-overview).

   1. Update dependencies and package the Helm chart to a `.tgz` chart archive:

      ```bash
      helm package -u .
      ```
      Where `-u` or `--dependency-update` is an option for the helm package command that updates chart dependencies before packaging. For more information, see [Helm Package](https://helm.sh/docs/helm/helm_package/) in the Helm documentation.

1. Add the chart archive to a release:

   1. In the `quick-start` directory, create a subdirectory named `manifests`:

      ```
      mkdir manifests
      ```

      You will add the files required to support installation with Embedded Cluster to this subdirectory.

   1. Move the Helm chart archive that you created to `manifests`:

      ```
      mv chart/slackernews/slackernews-0.4.14.tgz manifests
      ```

   1. In `manifests`, create the following YAML files:
      ```
      cd manifests
      ```
      ```
      touch slackernews.yaml replicated-app.yaml k8s-app.yaml embedded-cluster.yaml config.yaml
      ```

   1. In each of the files that you created, paste the corresponding YAML provided in the tabs below:

      <Tabs>
      <TabItem value="helmchart" label="slackernews.yaml" default>
      <h5>Description</h5>
      <p>The KOTS HelmChart custom resource provides instructions to KOTS about how to deploy the Helm chart. The <code>name</code> and <code>chartVersion</code> listed in the HelmChart custom resource must match the name and version of a Helm chart archive in the release. The <a href="/vendor/helm-optional-value-keys#conditionally-set-values"><code>optionalValues</code></a> field sets the specified Helm values when a given conditional statement evaluates to true. This HelmChart resource includes several `values` and conditional `optionalValues` that are supplied to `helm template` during deployment.</p>
      <h5>YAML</h5>
      <HelmChartCr/>
      </TabItem>
      <TabItem value="replicated-app" label="replicated-app.yaml">
      <h5>Description</h5>
      <p>The KOTS Application custom resource enables features in the Replicated Admin Console such as branding, release notes, application status indicators, and custom graphs.</p><p>The YAML below provides a name for the application to display in the Admin Console, adds custom <em>status informers</em> that are used to display the status of the deployment in the Admin Console dashboard, adds a custom application icon, and adds the port where the Slackernews service can be accessed so that the user can open the application after installation.</p>
      <h5>YAML</h5>
      <KotsCr/>
      </TabItem>
      <TabItem value="k8s-app" label="k8s-app.yaml">
      <h5>Description</h5>
      <p>The Kubernetes SIG Application custom resource supports functionality such as including buttons and links on the Replicated Admin Console dashboard. The YAML below adds an <strong>Open App</strong> button to the Admin Console dashboard that opens the application using the service port defined in the KOTS Application custom resource.</p>
      <h5>YAML</h5>
      <K8sCr/>
      </TabItem>
      <TabItem value="ec" label="embedded-cluster.yaml">
      <h5>Description</h5>
      <p>To install your application with Embedded Cluster, an Embedded Cluster Config must be present in the release. At minimum, the Embedded Cluster Config sets the version of Embedded Cluster that will be installed. You can also define several characteristics about the cluster.</p>
      <h5>YAML</h5>
      <EcCr/>
      </TabItem>
      <TabItem value="config" label="config.yaml">
      <h5>Description</h5>
      <p>The Config custom resource defines the application config fields that are exposed to the user in the Admin Console.</p>
      <h5>YAML</h5>
      <ConfigCr/>
      </TabItem>
      </Tabs>

   1. Lint the YAML files:

      ```bash
      replicated release lint --yaml-dir .
      ```
      **Example output:**
      ```bash
      RULE                                  TYPE    FILENAME         LINE    MESSAGE
      preflight-spec                        warn                                                                                                                                                    Missing preflight spec
      troubleshoot-spec                     warn                                                                                                                                                    Missing troubleshoot spec
      nonexistent-status-informer-object    warn    kots-app.yaml    8       Status informer points to a nonexistent kubernetes object. If this is a Helm resource, this warning can be ignored.
      ```
      :::note
      You can ignore any warning messages for the purpose of this quick start.
      :::

   1. Create the release and promote it to the Unstable channel:

      ```bash
      replicated release create --yaml-dir . --promote Unstable
      ```
      **Example output**:
      ```bash
        • Reading manifests from . ✓
        • Creating Release ✓
          • SEQUENCE: 1
        • Promoting ✓
          • Channel 2kvjwEj4uBaCMoTigW5xty1iiw6 successfully set to release 1
      ```

1. Create a test customer so that you can install the release on your VM with Embedded Cluster:

   1. In the [Vendor Portal](https://vendor.replicated.com), under the application drop down, select the SlackerNews application that you created.

      <img alt="App drop down" src="/images/quick-start-select-gitea-app.png" width="250px"/>

      [View a larger version of this image](/images/quick-start-select-gitea-app.png)
   
   1. Click **Customers > Create customer**.

      The **Create a new customer** page opens:

      ![Customer a new customer page in the Vendor Portal](/images/create-customer.png)

      [View a larger version of this image](/images/create-customer.png)

   1. For **Customer name**, enter a name for the customer. For example, `Example Customer`.

   1. For **Channel**, select **Unstable**. This allows the customer to install releases promoted to the Unstable channel.

   1. For **License type**, select **Development**.

   1. For **License options**, enable **Embedded Cluster Enabled**.

   1. Click **Save Changes**.

1. Create a VM with Compatibility Matrix:

   1. In the Vendor Portal, go the Compatibility Matrix.

   1. Click **Create > Create VM**.

   1. For **Distribution**, select Ubuntu. For **Instance type** select r1.small. This instance type meets the requirements for Embedded Cluster and SlackerNews.

   1. On the **Ingress & Ports** tab, For **Add DNS record**, click **Add** to create a DNS record using the default settings. This will allow you to access the Admin Console in a browser during installation.

   1. Click **Create** and wait for the VM status to be Running.

   1. When the VM is running, open a command prompt and run the `ssh` command that's provided in the Vendor Portal.

   1. If you are prompted to add the fingerprint for replicatedvm.com, type `yes` and press Enter.

   1. When prompted, provide the passphrase for the SSH key in your linked GitHub account. Comaptibility Matrix uses GitHub SSH to provide access to the VM. 

1. Install the application with Embedded Cluster:
     
    1. On the page for the customer that you created, click **Install instructions > Embedded Cluster**.

       ![Customer install instructions dropdown](/images/customer-install-instructions-dropdown.png)

       [View a larger image](/images/customer-install-instructions-dropdown.png)

    1. On the command line where you SSH-ed into the VM, run the commands in the **Embedded cluster install instructions** dialog to download the latest release, extract the installation assets, and install.

       <img width="500px" src="/images/embedded-cluster-install-dialog-latest.png" alt="embedded cluster install instructions dialog"/>

       [View a larger version of this image](/images/embedded-cluster-install-dialog-latest.png)

   1. When prompted, enter a password for accessing the Admin Console.

      The installation command takes a few minutes to complete.

      **Example output:**

      ```bash
      ? Enter an Admin Console password: ********
      ? Confirm password: ********
      ✔  Host files materialized!
      ✔  Running host preflights
      ✔  Node installation finished!
      ✔  Storage is ready!
      ✔  Embedded Cluster Operator is ready!
      ✔  Admin Console is ready!
      ✔  Additional components are ready!
      Visit the Admin Console to configure and install slackernews-kite: http://104.155.145.60:30000
      ```

      At this point, the cluster is provisioned and the Admin Console is deployed, but the application is not yet installed.

   1. To access the Admin Console, go back to the **Compatibility Matrix** page in the Vendor Portal and copy the URL provided for the DNS record that you added for the VM. This URL will provide a tunnel so that you can access the Admin Console from your local machine.
   
   1. On the Admin Console landing page, click **Start**.

   1. On the **Secure the Admin Console** screen, review the instructions and click **Continue**. In your browser, follow the instructions that were provided on the **Secure the Admin Console** screen to bypass the warning.

   1. On the **Certificate type** screen, either select **Self-signed** to continue using the self-signed Admin Console certificate or click **Upload your own** to upload your own private key and certificacte.

       By default, a self-signed TLS certificate is used to secure communication between your browser and the Admin Console. You will see a warning in your browser every time you access the Admin Console unless you upload your own certificate.

   1. On the login page, enter the Admin Console password that you created during installation and click **Log in**.

   1. On the **Configure the cluster** screen, you can view details about the VM where you installed, including its node role, status, CPU, and memory. Users can also optionally add additional nodes on this page before deploying the application. Click **Continue**. 

       The Admin Console dashboard opens.

   1. On the Admin Console dashboard, next to the version, click **Deploy** and then **Yes, Deploy**. 

      The application status changes from Missing to Unavailable while the application is being deployed.

   1. After a few minutes when the application status is Ready, click **Open App** to view SlackerNews in a browser.
   
      For example:

      ![Admin console dashboard showing ready status](/images/gitea-ec-ready.png)

      [View a larger version of this image](/images/gitea-ec-ready.png)

      <img alt="Slackernews landing page" src="/images/gitea-app.png" width="600px"/>

      [View a larger version of this image](/images/gitea-app.png) 

1. Return to the Vendor Portal and go to **Customers**. Under the name of the customer, confirm that you can see an active instance.

   This instance telemetry is automatically collected and sent back to the Vendor Portal by both KOTS and the Replicated SDK. For more information, see [About Instance and Event Data](/vendor/instance-insights-event-data).

1. Under **Instance ID**, click on the ID to view additional insights including the versions of Kubernetes and the Replicated SDK running in the cluster where you installed the application. For more information, see [Instance Details](/vendor/instance-insights-details).    

1. Create a new release that adds preflight checks to the application:

   1. In your local filesystem, go to the `quick-start/chart/slackernews` directory.

   1. Create a `preflights.yaml` file in the `templates` directory for the chart:

      ```
      touch templates/preflights.yaml
      ```

   1. In the `preflights.yaml` file, add the following YAML to create a Kubernetes Secret with a simple preflight spec: 

      ```yaml
      apiVersion: v1
      kind: Secret
      metadata:
        name: slackernews-preflight
        labels:
          troubleshoot.sh/kind: preflight
      stringData:
        preflight.yaml: |-
          apiVersion: troubleshoot.sh/v1beta2
          kind: Preflight
          metadata:
            name: slackernews-preflight
          spec:
            collectors:
              - clusterInfo: {}
              - clusterResources: {}
              - http:
                  collectorName: slack
                  get:
                    url: https://api.slack.com/methods/api.test
                    timeout: 20s
            analyzers:
              # verify that slack is accessible
              - textAnalyze:
                  checkName: Slack Accessible
                  fileName: slack.json
                  regex: '"status": 200,'
                  outcomes:
                    - pass:
                        when: "true"
                        message: "Can access the Slack API"
                    - fail:
                        when: "false"
                        message: "Cannot access the Slack API. Check that the server can reach the internet and check [status.slack.com](https://status.slack.com)."
      ```
      
      The YAML above defines a preflight check that confirms that an HTTP request to the Slack API at `https://api.slack.com/methods/api.test` made from the cluster returns a successful response of `"status": 200,`.

   1. In the `Chart.yaml` file, increment the version to 0.4.15:

      ```yaml
      # Chart.yaml
      version: 0.4.15
      ```

   1. Update dependencies and package the chart to a `.tgz` chart archive:

      ```bash
      helm package -u .
      ```

   1. Move the chart archive to the `manifests` directory:

      ```bash
      mv slackernews-0.4.15.tgz ../../manifests
      ```

   1. In the `manifests` directory, open the KOTS HelmChart custom resource (`slackernews.yaml`) and update the `chartVersion`:

      ```yaml
      # slackernews.yaml KOTS HelmChart
      chartVersion: 0.4.15
      ```  

   1. Remove the chart archive for version 0.4.14 of the chart from the `manifests` directory:

      ```
      rm slackernews-0.4.14.tgz
      ```        

   1. From the `manifests` directory, create and promote a new release, setting the version label of the release to `0.0.2`:  

      ```bash
      replicated release create --yaml-dir . --promote Unstable --version 0.0.2
      ```
      **Example output**:
      ```bash
        • Reading manifests from . ✓
        • Creating Release ✓
          • SEQUENCE: 2
        • Promoting ✓
          • Channel 2kvjwEj4uBaCMoTigW5xty1iiw6 successfully set to release 2
      ```

1. On your VM, update the application instance to the new version that you just promoted:

   1. In the Admin Console, go to the **Version history** tab.

      The new version is displayed automatically.

   1. Click **Deploy** next to the new version.

      The Embedded Cluster upgrade wizard opens.

   1. In the Embedded Cluster upgrade wizard, on the **Preflight checks** screen, note that the "Slack Accessible" preflight check that you added was successful. Click **Next: Confirm and deploy**.   

      ![preflight page of the embedded cluster upgrade wizard](/images/quick-start-ec-upgrade-wizard-preflight.png)

      [View a larger version of this image](/images/quick-start-ec-upgrade-wizard-preflight.png)  

   1. On the **Confirm and Deploy** page, click **Deploy**.

## Next Steps

Congratulations! As part of this quick start, you:
* Added the Replicated SDK to a Helm chart
* Created a release with the Helm chart
* Installed the release on a VM with Embedded Cluster
* Viewed telemetry for the installed instance in the Vendor Portal
* Created a new release to add preflight checks to the application
* Updated the application using Embedded Cluster

Now that you are familiar with the workflow of creating, installing, and updating releases, you can begin onboarding your own application to the Replicated Platform.

To get started, see [Onboard to the Replicated Platform](replicated-onboarding).

## Related Topics

For more information about the Replicated Platform features mentioned in this quick start, see:

* [About Distributing Helm Charts with KOTS](/vendor/helm-native-about)
* [About Preflight Checks and Support Bundles](/vendor/preflight-support-bundle-about)
* [About the Replicated SDK](/vendor/replicated-sdk-overview)
* [Introduction to KOTS](/intro-kots)
* [Managing Releases with the CLI](/vendor/releases-creating-cli)
* [Packaging a Helm Chart for a Release](/vendor/helm-install-release)
* [Using Embedded Cluster](/vendor/embedded-overview)

## Related Tutorials

For additional tutorials related to this quick start, see:

* [Deploying a Helm Chart on a VM with Embedded Cluster](/vendor/tutorial-embedded-cluster-setup)
* [Adding Preflight Checks to a Helm Chart](/vendor/tutorial-preflight-helm-setup)
* [Deploying a Helm Chart with KOTS and the Helm CLI](/vendor/tutorial-kots-helm-setup)