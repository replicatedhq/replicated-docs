import DependencyYaml from "../partials/replicated-sdk/_dependency-yaml.mdx"
import HelmPackage from "../partials/helm/_helm-package.mdx"
import Requirements from "../partials/embedded-cluster/_requirements.mdx"

# Install SlackerNews With Embedded Cluster From the Command Line

This topic provides a tutorial that demonstrates how to perform an automated or _headless_ installation for an application distributed with Replicated using the Replicated Embedded Cluster installer.

## Introduction

This tutorial shows how to install a Helm chart with Replicated Embedded Cluster from the command line without interacting with the Admin Console UI. This is also known as a _headless_ installation. Headless installations are often used for automating application deployment as part of CI/CD pipelines.

In this tutorial, you will:

* Download the Helm chart and release manifests for the sample SlackerNews application
* Create a release for SlackerNews in the Replicated Platform
* Create a ConfigValues file to pass application-specific configuration values to the installation from the command line
* On a VM, run the Embedded Cluster `install` command to perform a headless install of SlackerNews

## Set Up Your Environment

Before you begin, do the following to set up your environment:

* Install the Helm CLI, which is the tool for interacting with Helm and managing Helm charts. See [Install Helm](/vendor/environment-setup#install-helm).

* Ensure that you have access to a VM that meets the requirements for Embedded Cluster:

   * **Option 1: Use Compatibility Matrix.** To use Replicated Compatibility Matrix to create a VM, do the following before proceeding:
      
      * Request Compatibility Matrix credits. You can request credits by creating a Vendor Portal account and then going to [**Compatibility Matrix > Request more credits**](https://vendor.replicated.com/compatibility-matrix) in the Vendor Portal. For more information about creating an account, see [Create a Vendor Account](vendor-portal-creating-account). For more information about Compatibility Matrix credits, see [Billing and Credits](/vendor/testing-about#billing-and-credits).

          :::note
          If you are new to the Replicated platform, you might be eligible for $100 in free Compatibility Matrix credits. To request your free credits, reach out to our sales team at https://www.replicated.com/contact and note in the comments that you are completing a Replicated tutorial.
          :::
      
      * Ensure that you have an SSH key in your GitHub account. Then, add your GitHub username to your Vendor Portal [**Account Settings**](https://vendor.replicated.com/account-settings). This will provide SSH access to VMs that you create with Compatibility Matrix. For more information, see [Set Up SSH Access](/vendor/testing-vm-create#set-up-ssh-access) in _Create VMs_.

      After you complete the prerequisites above, continue to the [Tutorial](#tutorial). You will create the VM with Compatibility Matrix as part of the tutorial.

   * **Option 2: Bring your own VM.** Your VM must meet these requirements:

      * Firewalls must allow HTTP and HTTPS traffic.

      <Requirements/>

   For more information, see [Set Up Development Environments for Testing](/vendor/environment-setup#dev).

## Tutorial

### Create the Application

1. On your local machine, install the Replicated CLI:

   * MacOS

      ```bash
      brew install replicatedhq/replicated/cli
      ```
   * Linux / Windows Subsystem for Linux (WSL)

      ```bash
      version=$(curl -s https://api.github.com/repos/replicatedhq/replicated/releases/latest \
         | grep -m1 -Po '"tag_name":\s*"v\K[^"]+')
      curl -Ls \
         "https://github.com/replicatedhq/replicated/releases/download/v${version}/replicated_${version}_linux_amd64.tar.gz" \
         -o replicated.tar.gz
      tar xf replicated.tar.gz replicated && rm replicated.tar.gz
      mv replicated /usr/local/bin/replicated
      ``` 
   For more information and additional installation options, see [Install the Replicated CLI](/reference/replicated-cli-installing).

1. Authorize the Replicated CLI:

   ```bash
   replicated login
   ```
   In the browser window that opens, follow the prompt to log in to your Vendor Portal account and authorize the CLI.

1. Create an application SlackerNews:

   ```bash
   replicated app create "SlackerNews"
   ```
   :::note
   If you already have an application named SlackerNews in your Vendor Portal team, you can add a qualifier to the name. For example, `"SlackerNews Tutorial"` or `"SlackerNews YOUR_NAME"`.
   :::

1. Set the `REPLICATED_APP` environment variable to the application that you created:

   ```bash
   export REPLICATED_APP=APP_SLUG
   ```
   Where `APP_SLUG` is the unique application slug provided in the output of the `app create` command.

   Setting the `REPLICATED_APP` environment variable allows you to interact with the application using the Replicated CLI without needing to use the `--app` flag with every command.  

### Create the Release       

1. Run the following command to download version 1.0.1 of the sample SlackerNews Helm chart to a new `tutorial-headless-install` directory: 

   ```bash
   curl -O --create-dirs --output-dir tutorial-headless-install https://docs.replicated.com/slackernews-1.0.1.tar.gz
   ```

1. Untar the chart:

   ```bash
   tar -xzf tutorial-headless-install/slackernews-1.0.1.tar.gz -C tutorial-headless-install/ && rm tutorial-headless-install/slackernews-1.0.1.tar.gz
   ```

1. Change to the `slackernews` chart directory:
      
   ```bash
   cd tutorial-headless-install/chart/slackernews
   ```

1. List the files in the `slackernews` directory to view the contents of the Helm chart:
   ```bash
   ls
   ```
   ```bash
   Chart.lock  Chart.yaml  NOTES.txt   README.md   templates   values.yaml
   ``` 

1. Update dependencies and package the Helm chart to a `.tgz` chart archive:

   ```bash
   helm package --dependency-update .
   ```
   Where `--dependency-update` (or `-u`) is an option for the `helm package` command that updates chart dependencies before packaging. For more information, see [Helm Package](https://helm.sh/docs/helm/helm_package/) in the Helm documentation.

   The output of this command is a file named `slackernews-1.0.1.tgz`.

1. Change from the `slackernews` chart directory to the `tutorial-headless-install` directory.

    ```bash
    cd ../../
    ```

1. Download the release manifests:

    ```bash
   curl -O --create-dirs --output-dir manifests https://docs.replicated.com/slackernews-1.0.1-manifests.tar.gz
   ```

1. Untar:

    ```bash
    tar -xzf manifests/slackernews-1.0.1-manifests.tar.gz && rm manifests/slackernews-1.0.1-manifests.tar.gz
    ```

1. Move the `slackernews-1.0.1.tgz` chart archive that you created to the new `manifests` directory:

   ```bash
   mv chart/slackernews/slackernews-1.0.1.tgz manifests
   ```

1. Change to the new `manifests` directory and view the contents:

   ```bash
   cd manifests && ls
   ```
   ```bash
   config.yaml   embedded-cluster.yaml   k8s-app.yaml   replicated-app.yaml   slackernews-1.0.1.tgz   slackernews.yaml
   ```

1. Lint the YAML files in the `manifests` directory:

   ```bash
   replicated release lint --yaml-dir .
   ```
   **Example output:**
   ```bash
   RULE                                TYPE   FILENAME             LINE   MESSAGE
   may-contain-secrets                 info   slackernews.yaml     142    It looks like there might be secrets in this file
   preflight-spec                      warn                               Missing preflight spec
   troubleshoot-spec                   warn                               Missing troubleshoot spec
   nonexistent-status-informer-object  warn   replicated-app.yaml  14     Status informer points to a nonexistent kubernetes object. If this is a Helm resource, this warning can be ignored.
   nonexistent-status-informer-object  warn   replicated-app.yaml  15     Status informer points to a nonexistent kubernetes object. If this is a Helm resource, this warning can be ignored.
   nonexistent-status-informer-object  warn   replicated-app.yaml  16     Status informer points to a nonexistent kubernetes object. If this is a Helm resource, this warning can be ignored.
   ```
   :::note
   You can ignore `info` or `warn` messages for the purpose of this tutorial.
   :::      

1. From the `manifests` directory, create a release and promote it to the Unstable channel:

   ```bash
   replicated release create --yaml-dir . --promote Unstable
   ```
   **Example output**:
   ```bash
   • Reading manifests from . ✓
   • Creating Release ✓
      • SEQUENCE: 1
   • Promoting ✓
      • Channel 2kvjwEj4uBaCMoTigW5xty1iiw6 successfully set to release 1
   ```

### Create a Customer

Create a test customer so that you can install the release in your VM with Embedded Cluster:

1. Log in to the [Vendor Portal](https://vendor.replicated.com).

1. Under the application drop down, select the SlackerNews application that you created.

   <img alt="App drop down" src="/images/quick-start-app-dropdown-slackernews.png" width="250px"/>

   [View a larger version of this image](/images/quick-start-app-dropdown-slackernews.png)

1. Click **Customers > Create customer**.

   The **Create a new customer** page opens:

   ![Customer a new customer page in the Vendor Portal](/images/create-customer.png)

   [View a larger version of this image](/images/create-customer.png)

1. For **Customer name**, enter a name for the customer. For example, `Example Customer`.

1. For **Assigned Channel**, select **Unstable**. This allows the customer to install releases promoted to the Unstable channel.

1. For **Customer type**, select **Development**.

1. For **Install types**, enable **Embedded Cluster (current generation product)**.

1. Click **Save Changes**.

### Create the Compatibility Matrix VM   

:::note
Skip these steps if you are using your own VM.
:::

1. Create an Ubuntu VM that expires after two hours:

   ```bash
   replicated vm create --distribution ubuntu --version 24.04 --instance-type r1.small --disk 50 --ttl 2h
   ```
   **Example output:**
   ```bash
   ID        NAME             DISTRIBUTION  VERSION  STATUS  NETWORK   CREATED               EXPIRES   COST
   97940819  practical_black  ubuntu        24.04    queued  c726ffff  2025-08-20 14:32 MDT  -         $0.69
   ```

1. After a few minutes, check the status of the VM to see when it is `running`:

   ```bash
   replicated vm ls
   ```
   **Example output:**
   ```bash
   ID        NAME             DISTRIBUTION  VERSION  STATUS   NETWORK   CREATED               EXPIRES                COST
   97940819  practical_black  ubuntu        24.04    running  c726ffff  2025-08-20 14:32 MDT  2025-08-20 16:33 MDT   $0.69
   ```

1. Add DNS records.   

### Create the ConfigValues      

1. On your local machine, create a ConfigValues file:

   ```bash
   touch slackernews-configvalues.yaml 
   ```
   The ConfigValues file allows you to set application-specific configuration values for SlackerNews from the command line rather than through the Admin Console UI. You will transfer this file to your VM and then pass it to the installation in a later step.

1. In `slackernews-configvalues.yaml`, add the following YAML:    

     ```yaml
     apiVersion: kots.io/v1beta1
     kind: ConfigValues
     spec:
     values:
       slackernews_domain:
         value: YOUR_DOMAIN
     ```
     Where `YOUR_DOMAIN` is the domain to use for SlackerNews. For Compatibility Matrix VMs, this is the hostname provided for the DNS record you created with port 443.

### SSH Onto the VM

If you brought your own VM, SSH onto the VM. If you created the VM with Compatibility Matrix, follow these steps to SSH onto the VM:

1. Run the following command to use the Compatibility Matrix Forwarder to SSH onto the VM:

      ```bash
      ssh VM_ID@replicatedvm.com
      ```
      Where `VM_ID` is the `ID` from the output of the `replicated vm ls` command.

      :::note
      If you are prompted to add the fingerprint for replicatedvm.com, type `yes` and press Enter.
      :::

1. When prompted, provide the passphrase for the SSH key in your linked GitHub account. Compatibility Matrix uses GitHub SSH to provide access to the VM.

### Install

1. In the Vendor Portal, on the page for the customer that you created, click **Embedded Cluster install instructions**.

   ![Customer install instructions](/images/quick-start-slackernews-customer-install-instructions-button.png)

   [View a larger version of this image](/images/quick-start-slackernews-customer-install-instructions-button.png)

1. On your VM, run the _first two commands_ in the **Embedded cluster install instructions** dialog to download the latest release and extract the installation assets. 

   Do not yet run the installation command.

   <img width="600px" src="/images/embedded-cluster-install-dialog-latest.png" alt="embedded cluster install instructions dialog"/>

   [View a larger version of this image](/images/embedded-cluster-install-dialog-latest.png)

1. Transfer the ConfigValues file that you created to your VM.

     If you are using a VM created with Compatibility Matrix, run the following command to transfer the file using scp:

     ```bash
     scp PATH_TO_CONFIGVALUES VM_ID@replicatedvm 
     ```
     Where:
     * `PATH_TO_CONFIGVALUES` is the path to the ConfigValues file that you create on your local machine.
     * `VM_ID` is the ID of your VM.

1. Run the following command to install:

    ```bash
    sudo ./APP_SLUG install --license license.yaml \
    --config-values PATH_TO_CONFIGVALUES \
    --admin-console-password ADMIN_CONSOLE_PASSWORD
    ```
    Where:
    * `APP_SLUG` with the unique slug for the application.
    * `ADMIN_CONSOLE_PASSWORD` with a password for accessing the Admin Console.
    * `PATH_TO_CONFIGVALUES` with the path to the ConfigValues file on the VM.

1. Open a shell to watch the application resources deploy.

     1. `sudo ./APP_SLUG shell`

     1. `kubectl get all --namespace slackernews`

1. Go to the domain that you listed for the SlackerNews to open the application and confirm that the installation was successful.