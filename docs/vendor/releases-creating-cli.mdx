import RepositoryCicdNote from "../partials/releases/_repository-cicd-note.mdx"

# Managing Releases with the CLI

This topic describes how to use the replicated CLI to create and promote releases.

## Prerequisites

Before you create a release using the replicated CLI, complete the following prerequisites:

* Install the replicated CLI. See [Installing the replicated CLI](/reference/replicated-cli-installing).
  
* Create a new application using the `replicated app create APP_NAME` command. You only need to do this procedure one time for each application that you want to deploy. See [`app create`](/reference/replicated-cli-app-create) in _Reference_.

* Set the `REPLICATED_APP` and `REPLICATED_API_TOKEN` environment variables. See [Set the Environment Variables](/reference/replicated-cli-installing#set-environment-variables) in _Installing the replicated CLI_.

  **Example**:

  ```bash
  export REPLICATED_APP=my-app-slug
  export REPLICATED_API_TOKEN=1234abcd
  ```

  :::note
  The token environment variable is valid for a single session. You must export it for each new session.
  :::

## Create a Release From a Local Directory

You can use the replicated CLI to create a release from the local directory that contains your application files.

To create and promote a new release:

1. If your release contains any Helm charts, package the Helm charts and add the `.tgz` files to the local directory with your application files. See [Creating a Helm Chart Package](helm-release-creating-package). For KOTS installs, each chart will also need [an acompanying HelmChart custom resource](helm-release#about-the-helmchart-custom-resource). The below examples assume you have a local directory at `PATH_TO_APP_DIR` containing you application manifests. For an example of what might be in a manifests directory, you can check out [replicated-starter-helm ](https://github.com/replicatedhq/replicated-starter-helm/tree/main/manifests) or [kots-sentry](https://github.com/replicatedhq/kots-sentry/tree/main/manifests).

1. Lint the application manifest files and ensure that there are no errors in the YAML:

  ```bash
  replicated release lint --yaml-dir=PATH_TO_APP_DIR
  ```

  Replace `PATH_TO_APP_DIR` with path to the directory of the application files.

  For more information about linting, see [release lint](/reference/replicated-cli-release-lint) and [Linter Rules](/reference/linter) in _Reference_. 

1. Create a new release:

    ```bash
    replicated release create --yaml-dir PATH_TO_APP_DIR
    ```
    Replace `PATH_TO_APP_DIR` with the path to the directory of the application files.

   For more information, see [release create](/reference/replicated-cli-release-create) or [release update](/reference/replicated-cli-release-update) in _Reference_. 

1. Verify that the release was created

    ```bash
    replicated release ls
    ```

1. Continue to edit and lint the release as needed, then update the release:

    ```
    replicated release update SEQUENCE --yaml-dir PATH_TO_APP_DIR
    ```
    Replace:
      
    -  `SEQUENCE` with the release sequence number. This identifies the existing release to be updated.
    -  `PATH_TO_APP_DIR` with the path to the directory of the application files.

    For more information, see [release update](/reference/replicated-cli-release-update) in _Reference_.

1. Promote the release when you are ready to test it. Releases cannot be edited after they are promoted. To make changes after promotion, you have to create a new release.

    ```
    replicated release promote SEQUENCE CHANNEL_NAME_OR_ID
    ```

    Replace:
      
    -  `SEQUENCE` with the release sequence number.
    -  `CHANNEL_NAME_OR_ID` with the channel ID or case sensitive name of the channel.

    For more information, see [release promote](/reference/replicated-cli-release-promote) in the replicated CLI documentation.

1. Verify that the release was promoted to the channel:

  ```
  replicated release ls
  ```

#### Tying it all together

You can combine the steps above to lint, create, and promote a release in one step with

  ```
  replicated release create --yaml-dir PATH_TO_APP_DIR --lint-release --promote CHANNEL_NAME_OR_ID
  ```

As before, verify your release with 

  ```
  replicated release ls
  ```

## Create a Release With a Helm Chart Only

For applications that contain only a single Helm chart, you can skip creating a directory for manifests and use the `--chart` flag to add your Helm chart to a release.

To create a release for an application that contains a Helm chart:

1. Package your Helm chart into a `.tgz`. See [Creating a Helm Chart Package](helm-release-creating-package).

1. Create a release and promote it to the Unstable channel:
   
   ```bash
   replicated release create --chart=CHART_TGZ_FILE --promote=Unstable
   ```

   Replace `CHART_TGZ_FILE` with the `.tgz` Helm chart package. For example, --chart=my-chart-1.0.0.tgz. As above in [Create a Release from a Local Directory](#create-a-release-from-a-local-directory), the `--promote` flag is optional.

1. Verify that the release was promoted to the channel:

  ```
  replicated release ls
  ```   
